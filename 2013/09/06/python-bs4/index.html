<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Python | Beautiful Soup模块 | ......</title>
  <meta name="author" content="Clavin Li">
  
  <meta name="description" content="一、简介
Beautiful Soup是一个用来解析HTML和XML的python库，很适合用于爬取网页，提供了很人性化的parse tree，比起传统的SGMLParser给力多了">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:title" content="Python | Beautiful Soup模块"/>
  <meta property="og:site_name" content="......"/>

  <link rel="alternate" href="/atom.xml" title="......" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <div class="wrapper">
    <header id="header"><div class="title">
  <h1><a href="/">......</a></h1>
  <p><a href="/"></a></p>
</div>
<nav class="nav">
  <ul>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2013-09-06T14:17:00.000Z"><a href="/2013/09/06/python-bs4/">9月 6 2013</a></time>
    
    
  
    <h1 class="title">Python | Beautiful Soup模块</h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="一、简介">一、简介</h3>
<p>Beautiful Soup是一个用来解析HTML和XML的python库，很适合用于爬取网页，提供了很人性化的parse tree，比起传统的SGMLParser给力多了</p>
<a id="more"></a>

<h3 id="二、安装">二、安装</h3>
<p><strong>安装Beautiful Soup</strong></p>
<figure class="highlight"><pre><div class="line">pip <span class="operator"><span class="keyword">install</span> beautifulsoup4</span></div></pre></figure>

<h3 id="三、例子">三、例子</h3>
<p>这里使用下列html源码来让Beautiful Soup解析</p>
<figure class="highlight"><pre><div class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"title"</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="title">b</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"story"</span>&gt;</span>Once upon a time there were three little sisters</div><div class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://example.com/elsie"</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">id</span>=<span class="value">"link1"</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="title">a</span>&gt;</span>,</div><div class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://example.com/lacie"</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">id</span>=<span class="value">"link2"</span>&gt;</span>Lacie<span class="tag">&lt;/<span class="title">a</span>&gt;</span> and</div><div class="line">    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://example.com/tillie"</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">id</span>=<span class="value">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="title">a</span>&gt;</span>;</div><div class="line">    and they lived at the bottom of a well.<span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"story"</span>&gt;</span>...<span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></figure>

<p>格式化源码</p>
<figure class="highlight python"><pre><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line">soup = BeautifulSoup(html_doc)</div><div class="line"><span class="keyword">print</span> (soup.prettify())</div><div class="line"><span class="comment"># &lt;html&gt;</span></div><div class="line"><span class="comment">#  &lt;head&gt;</span></div><div class="line"><span class="comment">#   &lt;title&gt;</span></div><div class="line"><span class="comment">#    The Dormouse's story</span></div><div class="line"><span class="comment">#   &lt;/title&gt;</span></div><div class="line"><span class="comment">#  &lt;/head&gt;</span></div><div class="line"><span class="comment">#  &lt;body&gt;</span></div><div class="line"><span class="comment">#   &lt;p class="title"&gt;</span></div><div class="line"><span class="comment">#    &lt;b&gt;</span></div><div class="line"><span class="comment">#     The Dormouse's story</span></div><div class="line"><span class="comment">#    &lt;/b&gt;</span></div><div class="line"><span class="comment">#   &lt;/p&gt;</span></div><div class="line"><span class="comment">#   &lt;p class="story"&gt;</span></div><div class="line"><span class="comment">#    Once upon a time there were three little sisters; and their names were</span></div><div class="line"><span class="comment">#    &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span></div><div class="line"><span class="comment">#     Elsie</span></div><div class="line"><span class="comment">#    &lt;/a&gt;</span></div><div class="line"><span class="comment">#    ,</span></div><div class="line"><span class="comment">#    &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;</span></div><div class="line"><span class="comment">#     Lacie</span></div><div class="line"><span class="comment">#    &lt;/a&gt;</span></div><div class="line"><span class="comment">#    and</span></div><div class="line"><span class="comment">#    &lt;a class="sister" href="http://example.com/tillie" id="link2"&gt;</span></div><div class="line"><span class="comment">#     Tillie</span></div><div class="line"><span class="comment">#    &lt;/a&gt;</span></div><div class="line"><span class="comment">#    ; and they lived at the bottom of a well.</span></div><div class="line"><span class="comment">#   &lt;/p&gt;</span></div><div class="line"><span class="comment">#   &lt;p class="story"&gt;</span></div><div class="line"><span class="comment">#    ...</span></div><div class="line"><span class="comment">#   &lt;/p&gt;</span></div><div class="line"><span class="comment">#  &lt;/body&gt;</span></div><div class="line"><span class="comment"># &lt;/html&gt;</span></div></pre></figure>

<p>测试下自带的一些数据结构</p>
<figure class="highlight"><pre><div class="line">soup.title</div><div class="line"># <span class="tag">&lt;<span class="title">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"></div><div class="line">soup.title.name</div><div class="line"># u'title'</div><div class="line"></div><div class="line">soup.title.string</div><div class="line"># u'The Dormouse's story'</div><div class="line"></div><div class="line">soup.title.parent.name</div><div class="line"># u'head'</div><div class="line"></div><div class="line">soup.p</div><div class="line"># <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"title"</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="title">b</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"></div><div class="line">soup.p['class']</div><div class="line"># u'title'</div><div class="line"></div><div class="line">soup.a</div><div class="line"># <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">href</span>=<span class="value">"http://example.com/elsie"</span> <span class="attribute">id</span>=<span class="value">"link1"</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div><div class="line"></div><div class="line">soup.find_all('a')</div><div class="line"># [<span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">href</span>=<span class="value">"http://example.com/elsie"</span> <span class="attribute">id</span>=<span class="value">"link1"</span>&gt;</span>Elsie<span class="tag">&lt;/<span class="title">a</span>&gt;</span>,</div><div class="line">#  <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">href</span>=<span class="value">"http://example.com/lacie"</span> <span class="attribute">id</span>=<span class="value">"link2"</span>&gt;</span>Lacie<span class="tag">&lt;/<span class="title">a</span>&gt;</span>,</div><div class="line">#  <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">href</span>=<span class="value">"http://example.com/tillie"</span> <span class="attribute">id</span>=<span class="value">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="title">a</span>&gt;</span>]</div><div class="line"></div><div class="line">soup.find(id="link3")</div><div class="line"># <span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"sister"</span> <span class="attribute">href</span>=<span class="value">"http://example.com/tillie"</span> <span class="attribute">id</span>=<span class="value">"link3"</span>&gt;</span>Tillie<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div></pre></figure>

<p>找出所有超链接出来</p>
<figure class="highlight"><pre><div class="line">for <span class="keyword">link</span> <span class="keyword">in</span> soup<span class="built_in">.</span>find_all(<span class="string">'a'</span>):</div><div class="line">    print (<span class="keyword">link</span><span class="built_in">.</span>get(<span class="string">'href'</span>))</div><div class="line"><span class="variable">#http</span>:<span class="comment">//example.com/elsie</span></div><div class="line"><span class="variable">#http</span>:<span class="comment">//example.com/lacie</span></div><div class="line"><span class="variable">#http</span>:<span class="comment">//example.com/tillie</span></div></pre></figure>

<p>分离出所有的文本内容</p>
<figure class="highlight"><pre><div class="line">print (soup.get_text())</div><div class="line"><span class="preprocessor">#The Dormouse's story</span></div><div class="line"><span class="preprocessor">#Once upon a time there were three little sisters</span></div><div class="line"><span class="preprocessor">#Elsie,</span></div><div class="line"><span class="preprocessor">#Lacie and</span></div><div class="line"><span class="preprocessor">#Tillie;</span></div><div class="line"><span class="preprocessor">#and they lived at the bottom of a well.</span></div><div class="line"><span class="preprocessor">#...</span></div></pre></figure>

<h3 id="四、实战">四、实战</h3>
<p>任务就是提取每部电影的标题跟种子的链接<br><img src="https://lh5.googleusercontent.com/-BFHTV0zsy_Q/U3sd-NUdZxI/AAAAAAAAAI4/2GFkkO_WZDc/s1083/python-bs4-1.png" alt="python-bs4-1.png"></p>
<figure class="highlight"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># _*_ coding=utf-8 _*_</span></div><div class="line"><span class="comment"># Filename: spider_btscg.py</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> urllib2</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"></div><div class="line">host = <span class="string">"http://www.btscg.com"</span></div><div class="line">pat_torrent = re.compile(<span class="string">r'(/uploads/.*?\.torrent)'</span>)</div><div class="line">pat_track = re.compile(<span class="string">r'(tracker.*?\.html)'</span>)</div><div class="line"></div><div class="line">html_source = urllib2.urlopen(host).read().decode(<span class="string">'gbk'</span>, <span class="string">'ignore'</span>).encode(<span class="string">'utf-8'</span>, <span class="string">'ignore'</span>)</div><div class="line">soup = BeautifulSoup(html_source)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_torrent_url</span><span class="params">(link)</span>:</span></div><div class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> link.find_all(<span class="string">'a'</span>):</div><div class="line">        <span class="keyword">if</span> pat_track.search(str(url[<span class="string">'href'</span>])):</div><div class="line">            <span class="keyword">print</span> <span class="string">"---------------------------------------------------------"</span></div><div class="line">            <span class="keyword">print</span> url.string</div><div class="line">        <span class="keyword">if</span> pat_torrent.search(str(url[<span class="string">'href'</span>])):</div><div class="line">            <span class="keyword">print</span> <span class="string">"\033[36m %s \033[0m"</span> % (host + url[<span class="string">'href'</span>])</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    link = soup.find(<span class="string">'div'</span>, {<span class="string">"id"</span>:<span class="string">"portal_block_8_content"</span>})</div><div class="line">    find_torrent_url(link)</div></pre></figure>

<p><strong>备注</strong><br>原理很简单，使用urllib2打开需要解析的网页（注意编码问题），然后使用BeautifulSoup格式化HTML源码，先查找电影栏目的div id，然后再找里面的所有超链接，最后使用re模块匹配torrent种子链接</p>

    
  </div>
  <footer>
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <div class="widget-wrapper">
    <aside id="sidebar">
  
  
    
      
      
    
      
      
    
      
      
    
      
      

<div class="widget recent-posts first">
  <h3 class="title">最近的文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/09/25/linux-server-nfs/">Server | CentOs 6配置NFS服务</a>
      </li>
    
      <li>
        <a href="/2014/09/21/linux-lvs-performance-optimize/">LVS |  LVS性能调优小记</a>
      </li>
    
      <li>
        <a href="/2014/05/15/python-multiprocessing/">Python | 多进程</a>
      </li>
    
      <li>
        <a href="/2014/05/15/python-pypi/">Python | pypi安装提示error invalid command &#39;egg_info&#39;</a>
      </li>
    
      <li>
        <a href="/2014/05/08/python-urllib2/">Python | urllib2模块【转】</a>
      </li>
    
  </ul>
</div>

    
      
      

<div class="widget blogroll">
  <h3 class="title">友情链接</h3>
  <ul class="entry">
  
    
    <li><a href="http://heroicyang.com/" target="_blank">Heroic Yang&#39;s Blog</a></li>
  
  </ul>
</div>

    
  
</aside>
<div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2014 <a href="/">Clavin Li</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>